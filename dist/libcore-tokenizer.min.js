!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("libcore")):"function"==typeof define&&define.amd?define("libcore-tokenizer",["libcore"],e):"object"==typeof exports?exports["libcore-tokenizer"]=e(require("libcore")):t["libcore-tokenizer"]=e(t.libcore)}(this,function(t){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="/assets/",e(e.s=10)}([function(e,n){e.exports=t},function(t,e,n){"use strict";function r(){}t.exports={clone:function(t){return r.prototype=t,new r}}},function(t,e,n){"use strict";function r(t){var e={};t="string"==typeof t?t:"start",e[t]={not:[]},this.stateGenId=0,this.start=t,this.states=e,this.ends={}}var i=n(0);r.prototype={constructor:r,generateState:function(t){return i.string(t)?t:"s"+ ++this.stateGenId},finalizeFragments:function(t,e,n){var r,i,s,o,a,l,u,c,f,h,p,g,d,x,b=this.states,v=this.ends,w={},m={},k=[e],O=1;for(m[e.state.id]=this.start;O--;){s=k[0],k.splice(0,1),r=m[s.state.id],r in b||(b[r]={not:[]}),i=b[r];for(o=s.pointer;o;o=o.next)if(a=o.chr,l=o.to,f=l.id,f in w||(w[f]=!0,k[O++]=l),r=l.state.id,r in m||(m[r]=this.generateState()),r=m[r],o.negative){for(g=i.not,p=d=g.length,h=null;p--&&(h=g[p],h[0]!==r);)h=null;h||(h=g[d++]=[r,{}]),x=h[1],a in x||(x[a]=1)}else a in i||(i[a]=[]),u=i[a],-1===u.indexOf(r)&&(u[u.length]=r)}for(c=n.length;c--;)v[m[n[c]]]=t},importDefinition:function(t){var e,n=i,r=n.object,s=n.string;if(s(t))try{t=JSON.parse(t)}catch(t){throw console.warn(t),new Error("Invalid JSON string parameter.")}if(!r(t))throw new Error("Invalid JSON object parameter.");if(e=t.stateGenId,!n.number(e)||e<0)throw new Error("Invalid state generator");if(this.stateGenId=e,e=t.start,!n.string(e))throw new Error("Invalid start state name");if(this.start=e,e=t.states,!r(e))throw new Error("Invalid state map object");if(this.states=e,e=t.ends,!r(e))throw new Error("Invalid end states object");return this.ends=e,this},exportDefinition:function(){return{stateGenId:this.stateGenId,start:this.start,states:this.states,ends:this.ends}}},t.exports=r},function(t,e,n){"use strict";t.exports=n(9)},function(t,e,n){"use strict";function r(t,e){if(this.id="f"+ ++t.fgen,this.state={id:null},this.builder=t,e){for(this.pointer=e;e.next;e=e.next);this.lastPointer=e,this.outgoing=this.lastOutgoing={fragment:this,next:null}}}var i=n(1);r.prototype={constructor:r,id:null,state:null,base:null,map:null,splitted:null,repeated:null,pointer:null,lastPointer:null,outgoing:null,lastOutgoing:null,link:function(t){var e,n,r,i,s=this,o=s.outgoing,a=s.splitted,l=t.splitted,u=s.repeated;for(t.applyState();o;o=o.next)o.fragment.pointer.point(t);if(u){for(n=t.lastPointer;u;u=u.next)e=u.pointer,n?n.next=e:t.pointer=e,n=e;t.lastPointer=n}if(i=t.pointer,a&&i){for(;a;a=a.next)r=a.fragment,e=i.clone(),n=r.lastPointer.last(),n.next=e[0],r.lastPointer=e[1];l&&(s.lastSplit().next=l),l=s.splitted}return r=s.clone(),r.splitted=l,r.repeated=t.repeated,r.outgoing=t.outgoing,r.lastOutgoing=t.lastOutgoing,r},lastSplit:function(){var t=this.splitted;if(t){for(;t.next;t=t.next);return t}return null},clone:function(){var t=this.base,e=i.clone(this);return t||(e.base=this),e.id="f"+ ++this.builder.fgen,e},split:function(t){var e=this,n=e.splitted,r={fragment:e,next:null},i=e.clone();return t&&i.repeat(),n||(i.splitted=r),i},repeat:function(){var t=this,e=t.pointer;return!t.repeated&&e&&(e=e.clone(),t.repeated={pointer:e[0],next:null}),t},fill:function(t){var e=this,n=e.clone(),r=e.pointer.range(t.pointer);return t.state=e.state,r?r[1].next=t.pointer:r=[t.pointer],e.lastPointer.next=r[0],n.lastPointer=t.lastPointer,n.outgoing.next=t.outgoing,n.lastOutgoing=t.lastOutgoing,n},merge:function(t){var e,n,r,i=this,s=i.clone();if(t.state=i.state,i.lastPointer.next=t.pointer,i.lastOutgoing.next=t.outgoing,s.lastPointer=t.lastPointer,s.lastOutgoing=t.lastOutgoing,n=i.splitted,e=t.splitted,s.splitted=n||e,n&&e){for(r=n;r.next;r=r.next);r.next=e}if(n=i.repeated,e=t.repeated,s.repeated=n||e,n&&e){for(r=n;r.next;r=r.next);r.next=e}return s},applyState:function(){var t=this.state;return t.id||(t.id="s"+ ++this.builder.gen),t}},t.exports=r},function(t,e,n){"use strict";function r(t){var e,n,r,f,h,p,g,d,x,b,v,w=i,m=c,k=s,O=o,y=a,I=l,S=u,P=0,E=0,$=null,j=[],A=0,C=null,z=null,G=[],J=0,N=0;for(r=w(P,t);r;r=w(P,t)){if(P=r[2],n=r[1],e=r[0],g=!1,e in m)switch(e){case"(":case"[":case"[^":g=!!C}else switch(C){case"char":case"]":case"]^":case")":case"+":case"?":case"*":case"range":g=!0}if(v=z&&z[1],g&&(G[J++]=["["===v?",":"[^"===v?"^,":".",null,2,E,0]),"[^"===v)switch(e){case"-":e="^-";break;case"]":e="]^";break;case"char":e="negative_char"}for(G[J++]=[e,n,0,E,P-E],E=P,C=e,f=J-N;f--;N++)if(r=G[N],e=r[0],n=r[1],e in m)switch(h=m[e],x=h[0],d=h[1],x){case S:case I:case y:r[2]=x===y?2:1;t:for(;$;$=$[0]){switch(p=$[1],p[0]){case I:case y:if(d<=p[1]){j[A++]=$[2];continue t}}break}x!==S?$=[$,h,r]:j[A++]=r;break;case k:$=[$,h,r],z=[z,e];break;case O:for(;$;$=$[0]){if(p=$[1],p[0]===k){if(p[2]!==e)throw new Error("Unmatched token found "+n);b=$[2][3],j[A++]=[h[2],null,1,b,r[3]-b+1],z&&(z=z[0]),$=$[0];break}j[A++]=$[2]}}else j[A++]=r}if($)throw new Error("Invalid token found "+$[2][1]);return j}var i=n(8),s=2,o=3,a=4,l=5,u=6,c={"[":[s,15,"]"],"[^":[s,15,"]^"],"]":[o,1,"[]"],"]^":[o,1,"[^]"],"(":[s,15,")"],")":[o,1,"()"],"?":[l,10],"+":[l,10],"*":[l,10],range:[l,10],"-":[a,7],"^-":[a,7],"^,":[a,5],",":[a,5],".":[a,5],"|":[a,3],$$:[u,1]};t.exports=r},function(t,e,n){"use strict";function r(t,e){t&&(this.chr=t),this.negative=!0===e}var i=n(1),s=n(0);r.prototype={constructor:r,negative:!1,repeated:!1,chr:"",to:null,next:null,clone:function(t){var e,n,r=this,o=null,a=i.clone,l=s.assign,u=!1!==t;for(t||(t=null);r&&(e=a(r),t&&l(e,t),o?n.next=e:o=e,n=e,u);r=r.next);return n.next=null,[o,n]},point:function(t){for(var e=this;e;e=e.next)e.to||(e.to=t);return this},last:function(){for(var t=this;t.next;t=t.next);return t},range:function(t){var e,n,i,s=this.chr,o=r,a=String,l=null,u=null,c=this.negative;for(e=s.charCodeAt(0),s=t.chr,t=s.charCodeAt(0),n=t-e-1;n--;)i=new o(a.fromCharCode(++e),c),l?u.next=i:l=i,u=i;return l&&[l,u]}},t.exports=r},function(t,e,n){"use strict";function r(t,e,n){var r,l,u,c,f,h,p,g=o,d=a,x=i(e),b=-1,v=x.length,w=null,m=null,k=0,O=[],y={gen:0,fgen:0};for(n instanceof s||(n=new s);v--;)switch(r=x[++b],l=r[0]){case".":w=[w[0][0],w[0][1].link(w[1])];break;case"?":w=[w[0],w[1].split()];break;case"+":w=[w[0],w[1].repeat()];break;case"*":w=[w[0],w[1].split(!0)];break;case"^,":case",":case"|":w=[w[0][0],w[0][1].merge(w[1],"^,"===l)];break;case"^-":case"-":w=[w[0][0],w[0][1].fill(w[1],"^-"===l)];break;case"$$":if(!w||null!==w[0])throw console.warn(w),new Error("Invalid end of expression.");for(c=w[1],f=new g(y,null),c.link(f),p=m.id,h=f.state.id,h!==p&&(O[k++]=h),u=c.splitted;u;u=u.next)(h=u.fragment.state.id)!==p&&(O[k++]=h);break;case"^":case"$":case"char":case"negative_char":c=new g(y,new d(r[1],"negative_char"===l)),m||(m=c.applyState()),w=[w,c]}return k&&n.finalizeFragments(t,w[1],O),y=w=u=c=f=null,n}var i=n(5),s=n(2),o=n(4),a=n(6);t.exports=r},function(t,e,n){"use strict";function r(t,e){var n,r,i=t+1,s=i+1,l=u,c=e.substring(i,s);switch(c){case"x":return r=i+2,n=e.substring(++i,r+1).match(o),n?[String.fromCharCode(parseInt(n[0],16)),r]:["x",s];case"u":return r=i+4,n=e.substring(++i,r+1).match(a),n?[String.fromCharCode(parseInt(n[0],16)),r]:["x",s];default:return[c in l?l[c]:c,s]}}function i(t,e){for(var n,r=t,i=e.length;i--;)if("}"===(n=e.charAt(++r))&&(n=e.substring(t+1,r),l.test(n)))return[n,r+1];return null}function s(t,e){var n,s,o,a=Math,l=e.length;if((t=a.max(0,t))>l)return null;if(t===l)return["$$",null,l+1];switch(s=t+1,n=e.charAt(t),o="char",n){case"\\":n=r(t,e),s=n[1],n=n[0],o="char";break;case"{":if(!(n=i(t,e)))throw new Error("Invalid token near "+e.substring(t,a.min(l,t+10)));s=n[1],n=n[0],o="range";break;case"[":if(s<l&&"^"===e.charAt(s)){o="[^",s++;break}case"]":case"(":case")":case"|":case"?":case"+":case"*":case"-":case"^":case"$":o=n}return o?[o,n,s]:null}var o=/^[a-fA-F0-9]{2}$/,a=/^[a-fA-F0-9]{4}$/,l=/^([0-9]+|[0-9]+\,[0-9]*|[0-9]*\,[0-9]+)$/,u={b:"\b",f:"\f",n:"\n",r:"\r",t:"\t",v:"\v","\\":"\\",B:"\\"};t.exports=s},function(t,e,n){"use strict";function r(){this.map=new s}var i=n(0),s=n(2),o=n(7);r.prototype={map:null,constructor:r,define:function(t){var e,n,r,s=i,a=s.string,l=s.regex,u=this.map,c=o,f=null;if(!s.array(t))throw new Error("Invalid definitions parameter.");for(n=-1,r=t.length;r--;)if(e=t[++n],a(e))f=e;else if(l(e)){if(e=e.source,!f)throw new Error("Token is not named "+e);c(f,e,u)}return this},fromJSON:function(t){return this.map.importDefinition(t),this},toJSON:function(){return JSON.stringify(this.toObject())},toObject:function(){return this.map.exportDefinition()},tokenize:function(t,e){var n,r,i,s,o,a,l,u,c,f,h=this.map,p=h.ends,g=h.states,d=[h.start,null],x=e.length,b=x-t,v=t-1,w=null;if(0===b)return["$","",x+1];if(b<1)return null;for(;b--;){for(n=e.charAt(++v),s=null;d;d=d[1]){if(a=d[0],l=g[a],a in p&&(w=[p[a],v]),n in l)for(o=l[n],r=-1,i=o.length;i--;)u=o[++r],s=[u,s],u in p&&(w=[p[u],v+1]);for(c=l.not,r=-1,i=c.length;i--;)u=c[++r],f=u[1],n in f||(u=u[0],s=[u,s],u in p&&(w=[p[u],v+1]))}if(!s)break;d=s}return w&&(w[2]=w[1],w[1]=e.substring(t,w[1])),w}},t.exports=r},function(t,e,n){t.exports=n(3)}])});